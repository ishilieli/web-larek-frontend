# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Архитектура: MVP

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


# Данные и типы данных, используемых в приложении.

### Типы

1. `ApiListResponse<Type>`: структура данных для ответа, включающая общее количество элементов и массив элементов.
2. `FormErrors`: содержит ошибки формы в виде пар "ключ: значение", где ключ - это имя поля формы, а значение - строка с текстом ошибки.
3. `PaymentMethod`: представляет два варианта оплаты - наличными или онлайн. Он используется для описания возможных методов оплаты заказа.
4. `OrderForm`: Этот тип представляет форму заказа IOrder без полей total и items. Он используется для создания формы заказа с исключенными определенными полями.
5. `CardId`: Тип карточки товара, исключая поле id из интерфейса IProduct

### Интерфейсы

1. `IProduct`: данные товара
2. `IFormState`: состояние формы
3. `IEvents`: методы работы с событиями
4. `IPaymentForm`: форма с данными о доставке
5. `IContactsForm`: форма с контактами юзера
6. `IOrder`: форма заказа
7. `IBasket`: корзина товаров
8. `ILarekAPI`: для работы с апи магазина
9. `IOrderResult`: результат заказа
10. `ISuccess`: успешно выполненный заказ
11. `IActions`: для описания действия onClick
12. `IModal`: модальное окно
13. `IPage`: интерфейс страницы с элементами каталога, счетчиком и блокировкой


# Архитектура приложения
**MVP**, или Model-View-Presenter, — это архитектурный шаблон, который разделяет приложение на три компонента: модель (данные), представление (UI) и презентатор (бизнес-логика)

### Базовые классы

#### Класс Api
Содержит базовую логику для отправки запросов на сервер. В конструкторе принимается базовый адрес сервера и опциональный объект с заголовками запросов

Методы класса:

-  **get** - выполняет GET запрос на указанный ендпоинт и возвращает промис с ответом сервера
-  **post** - отправляет данные в формате JSON на указанный ендпоинт методом POST. Метод запроса можно переопределить, указав третий параметр при вызове метода
-  **handleResponse** - обработчик ответа сервера

#### Класс EventEmitter
Представляет собой брокер событий, который позволяет отправлять и слушать события в приложении. Он используется в презентере для обработки событий и в других частях приложения для генерации событий

Методы класса:

- **on** - установить обработчик на событие
- **off** - удалить обработчик
- **emit** - инициировать событие с возможностью передачи данных
- **trigger** - возвращает функцию, которая инициирует указанное событие при вызове
- **onAll** - слушать все события
- **offAll** - сбросить все обработчики

#### Класс Component 
Абстрактный класс для отображения пользовательского интерфейса

Методы класса:

- **toggleClass** - переключается класс для переданного элемента
- **setText** - устанавливает текст
- **setImage** - устанавливает изображение
- **setDisabled** - устанавливает состояние блокировки
- **render** - рендерит компонент и возвращает корневой DOM-элемент

#### Класс View 
Класс для создания интерфейсов, но с генерацией событий, наследует класс Component, принимает container для передачи в Component и events типа EventEmitter брокер событий

### Слой представления

#### Класс Page
Класс для реализации главной страницы приложения: листинг карточек, счетчик корзины, отображение модального окна. Наследует класс View, принимает брокер событий и контейнер

Свойства класса:

- **_basket** - кнопка, открывающая модалку корзины
- **_catalog** - отображение каталога товаров
- **_preview** - контент внутри модалки
- **_wrapper** - элемент обертки страницы

Методы класса:

- **set counter** - устанавливает значение счетчика
- **set catalog** - заменяет содержимое каталога предоставленными данными
- **set locked** - блокирует прокрутку страницы при открытом модальном окне

#### Класс Modal
Класс для реализации модального окна: кнопка закрытия, контент окна. Наследует класс View, принимает брокер событий и контейнер

Свойства класса:

- **_content** - отображение контента внутри модального окна
- **_button** - кнопка для закрытия модального окна

Методы класса:

- **set content** - устанавливает контент модального окна
- **open** - метод для открытия модального окна
- **close** - метод для закрытия модального окна

#### Класс Basket
Класс для реализации представления корзины и отображения списка выбранных товаров, а так же добавление и удаление этих товаров

Свойства класса:

- **_list** - элемент для отображения списка карточек товаров
- **_total** - элемент для отображения общей стоимости товаров в корзине
- **_button** - элемент для дальнейших действий с корзиной

Методы класса:

- **set item** - задает список товаров в корзине
- **set total** - задает итоговую сумму всех товаров

#### Класс Success
Класс для отображения сообщения об успешном завершении операции или процесса, а так же отображения общей суммы операции, наследует класс Component

Свойства класса:

- **_totalPrice** - элемент для отображения общей суммы операции
- **_close** - html элемент кнопки закрытия
- **events** - для события клика по кнопке после завершения заказа

Методы класса:

- **set total** - устанавливает текст, отображающий сумму операции

#### Класс Form
Класс для создания форм с различным контентом, наследует класс Component. Выбирает все формы и вешает на них обработчики, обрабатывает ввод данных пользователя и отображает сообщения об ошибках

Свойства класса:

- **_submit** - элемент кнопки для дальнейших действия после заполнения формы
- **_errors** - элемент для отображения ошибок при заполнении формы

Методы класса:

- **onInputChange** - обработка событий ввода и оповещения всех подписчиков об изменении
- **render** - для отображения формы с учетом переданного состояния
- **set valid** - управляет доступностью кнопки отправки
- **set errors** - устанавливает и отображает ошибки валидации формы


#### Класс PaymentForm
Класс для реализации отображения и управления формой доставки, наследует класс Form

Свойства класса:

- **_paymentCard** = элемент кнопки оплаты онлайн
- **_paymentCash** - элемент кнопки оплаты за наличные

Методы класса:

- **set payment** - переключает активность кнопок оплаты
- **set address** - устанавливает адрес доставки

#### Класс ContactForm
Класс для реализации работы с формой контактных данных, наследует класс Form

Методы класса:

- **set phone** - устанавливает номер телефона
- **set email** - устанавливает адрес электронной почты

#### Класс Card
Класс для реализации карточек товаров в приложении, а так же настройки их атрибутов, наследует класс Component и работает с типом CardId

Свойства класса:

- **_index** - элемент для установки индекса товара
- **_title** - элемент для отображения названия товара
- **_price** - элемент для отображения цены товара
- **_image** - элемент для отображения изображения товара (необязательный)
- **_description** - элемент для отображения описания товара (необязательный)
- **_category** - элемент для отображения категории товара (необязательный)
- **_button** - элемент для действия на карточке товара (необязательный)

Методы класса:

- **set/get title** - управляет названием товара
- **set/get index** - управляет уникальным идентификатором товара
- **set/get price** - управляет ценой товара
- **set image** - устанавливает изображение товара
- **set description** - устанавливает описание товара
- **set/get category** -  управляет категорией товара
- **disablePriceButton** - управляет доступностью кнопки
- **set buttonTitle** - отображение текстового содержимым кнопки

### Слой данных

#### Класс AppData
Класс для работы с данными в приложении

Свойства класса:

- **items** - содержит в себе весь список продуктов
- **basket** - содержит корзину пользователя
- **order** - содержит в себе данные для заказа
- **formErrors** - для установки сообщений об ошибке в методах валидации

Методы класса:

- **setItems** - метод для инициализации списка товаров, полученных с сервера
- **inBasket** - проверка наличия товара в корзине
- **addBasket** - добавляет товар в корзину
- **removeBasket** - удаляет товар из корзины
- **setPreview** - установка контента для модального окна
- **clearBasket** - очищает корзину пользователя
- **setOrderField** - установка всех данных о заказе при успешной валидации
- **validationField** - валидация полей всех форм
- 
#### Класс LarekApi
Класс для взаимодействия с API приложения и получения информации о товарах и списках товаров, наследует класс Api, содержит свойство cdn только для чтения

Методы класса:

- **getProductList** - получает данные о каталоге товаров и возвращает массив объектов
- **getProductItem** - получает данные о конкретном товаре и возвращает объект с информацией о товаре
- **orderProducts** - отправляет заказ post запросом на сервер

### Слой Presenter
Содержит следующие события:

1. modal:open - открывает модальное окно
2. modal:close - закрывает модальное окно
3. order:result - очищает корзину и закрывает модалку
4. order:submit - отправляет данные заказа на сервер
5. order:success - отображает окно успешной оплаты
6. preview:change - отображает модалку с информацией о товаре
7. '^contacts\..*:change' - изменение полей контактной информации, обновление данных о контактах в приложении
8. '^order\..*:change' - изменение адреса заказа, обновление соответствующего поля в приложении
9. contacts:submit - отправка контактной информации
10. basket:open - открытие модального окна с содержимым корзины
11. basket:change - изменение списка товаров в корзине, обновление количества товаров на странице
12. card:select - выбор карточки товара, устанавливается превью товара.
13. formErrors:change - изменение ошибок в форме заказа, обновление статуса валидации и ошибок для формы оплаты и контактов.
14. items:change - изменение списка товаров, вызывает перерисовку каталога на странице